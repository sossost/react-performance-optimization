# ì˜ˆì œ 16: Web Workers í™œìš©

## ëª©ì 

ë©”ì¸ ìŠ¤ë ˆë“œ ë¶€í•˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ **Web Workers**ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ë…ë¦½ì ìœ¼ë¡œ í•™ìŠµí•˜ê¸° ìœ„í•œ ì˜ˆì œì…ë‹ˆë‹¤.
í˜„ì¬ëŠ” ë¬¸ì„œë§Œ ì œê³µí•˜ë©°, ì‹¤ìŠµ ì½”ë“œëŠ” ì¶”í›„ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.

---

## êµ¬ì¡°

ì•„ë˜ëŠ” êµ¬í˜„ ì˜ˆì • êµ¬ì¡°ì…ë‹ˆë‹¤.

- **Before ëª¨ë“œ**

  - ë¬´ê±°ìš´ ê³„ì‚°ì„ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ìˆ˜í–‰
  - ìŠ¤í¬ë¡¤/ì…ë ¥ ë°˜ì‘ì„±ì´ ì €í•˜ë¨
  - ê¸´ ì‘ì—… ì¤‘ UI í”„ë¦¬ì¦ˆ ë°œìƒ

- **After ëª¨ë“œ**

  - Web Workerë¡œ ê³„ì‚°ì„ ì˜¤í”„ë¡œë”©
  - ë©”ì¸ ìŠ¤ë ˆë“œëŠ” UI ì²˜ë¦¬ì— ì§‘ì¤‘
  - ì§„í–‰ ìƒíƒœ í‘œì‹œ ë° ê²°ê³¼ ìŠ¤íŠ¸ë¦¬ë°

- **ë ˆì´ì•„ì›ƒ**

  - Before/After ëª¨ë“œë¥¼ ë‚˜ë€íˆ ë¹„êµ
  - ëŒ€ìš©ëŸ‰ ê³„ì‚°(ì •ë ¬/í•„í„°/ì§‘ê³„) ì‹œ UI ë°˜ì‘ì„± ë¹„êµ
  - ì‘ì—… ì§„í–‰ ìƒíƒœì™€ ì™„ë£Œ ì‹œê°„ ë¹„êµ

---

## ğŸ“š ì´ë¡ : Web Workers ì›ë¦¬ì™€ ì „ëµ

## 1. ê°œìš” (Overview)

**Web Worker**ëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì™€ ë¶„ë¦¬ëœ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ
JavaScriptë¥¼ ì‹¤í–‰í•˜ì—¬ UI ë Œë”ë§ì„ ë°©í•´í•˜ì§€ ì•Šê²Œ í•´ì¤ë‹ˆë‹¤.

í•µì‹¬ ê°œë…:

- **Main Thread**: UI, ì´ë²¤íŠ¸ ì²˜ë¦¬, ë Œë”ë§ ë‹´ë‹¹
- **Worker Thread**: ê³„ì‚°/íŒŒì‹± ë“± ë¬´ê±°ìš´ ì‘ì—… ë‹´ë‹¹
- **postMessage**: ë©”ì‹œì§€ ê¸°ë°˜ í†µì‹ 
- **Structured Clone**: ë°ì´í„° ë³µì‚¬ ë°©ì‹ (í° ë°ì´í„°ëŠ” ë¹„ìš© í¼)
- **Transferable**: ì†Œìœ ê¶Œ ì´ë™ìœ¼ë¡œ ë³µì‚¬ ë¹„ìš© ì ˆê°

---

## 2. Web Workersì™€ ì„±ëŠ¥ì˜ ê´€ê³„

### 2.1 ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°©ì§€

- **Before**: í° ê³„ì‚°ì´ UI ì…ë ¥/ìŠ¤í¬ë¡¤ì„ ë§‰ìŒ
- **After**: ê³„ì‚°ì„ ì›Œì»¤ë¡œ ì˜¤í”„ë¡œë”©, UI ì¦‰ì‹œ ë°˜ì‘
- **íš¨ê³¼**: ì…ë ¥ ì§€ì—° ê°ì†Œ, í”„ë ˆì„ ë“œë ê°ì†Œ

### 2.2 ì‘ì—… ë³‘ë ¬í™”

- **Before**: ëª¨ë“  ê³„ì‚°ì„ ìˆœì°¨ì ìœ¼ë¡œ ë©”ì¸ì—ì„œ ì²˜ë¦¬
- **After**: ì›Œì»¤ë¡œ ë³‘ë ¬ ì²˜ë¦¬ (ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´)
- **íš¨ê³¼**: ì „ì²´ ì²˜ë¦¬ ì‹œê°„ ê°ì†Œ, ì‚¬ìš©ì ì²´ê° ê°œì„ 

### 2.3 ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬

- **Before**: í° ë°°ì—´ ì²˜ë¦¬ ì¤‘ UI í”„ë¦¬ì¦ˆ
- **After**: ì›Œì»¤ì—ì„œ ì²˜ë¦¬, UIëŠ” ì§„í–‰ ìƒíƒœ í‘œì‹œ
- **íš¨ê³¼**: ì‚¬ìš©ì ê²½í—˜ ì•ˆì •

---

## 3. ë¬¸ì œ ìƒí™©: ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë¬´ê±°ìš´ ê³„ì‚°

### âŒ Bad Case

```tsx
function handleClick() {
  const result = heavyCompute(largeData);
  setOutput(result);
}
```

### ë¬¸ì œì 

- ê³„ì‚°ì´ ëë‚  ë•Œê¹Œì§€ UIê°€ ë©ˆì¶¤
- ìŠ¤í¬ë¡¤/ì…ë ¥ ì´ë²¤íŠ¸ê°€ ì§€ì—°ë¨
- ì•±ì´ ë©ˆì¶˜ ê²ƒì²˜ëŸ¼ ë³´ì„

---

## 4. Web Worker ê¸°ë³¸ ì‚¬ìš©ë²•

### 4.1 ì›Œì»¤ ìƒì„±ê³¼ ë©”ì‹œì§€ í†µì‹ 

```ts
// main.ts
const worker = new Worker(new URL("./worker.ts", import.meta.url));

worker.postMessage({ type: "START", payload: largeData });

worker.onmessage = (event) => {
  const { type, payload } = event.data;
  if (type === "DONE") {
    setOutput(payload);
  }
};
```

```ts
// worker.ts
self.onmessage = (event) => {
  const { type, payload } = event.data;
  if (type === "START") {
    const result = heavyCompute(payload);
    self.postMessage({ type: "DONE", payload: result });
  }
};
```

### 4.2 ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸

```ts
// worker.ts
for (let i = 0; i < total; i += 1) {
  // ì¼ë¶€ ì§„í–‰ í›„ ìƒíƒœ ì „ë‹¬
  if (i % 1000 === 0) {
    self.postMessage({ type: "PROGRESS", payload: i / total });
  }
}
```

---

## 5. Transferableë¡œ ë³µì‚¬ ë¹„ìš© ì¤„ì´ê¸°

í° ë°ì´í„°ë¥¼ ë©”ì‹œì§€ë¡œ ë³´ë‚¼ ë•Œ ë³µì‚¬ ë¹„ìš©ì´ í½ë‹ˆë‹¤.
**Transferable**ì„ ì‚¬ìš©í•˜ë©´ ì†Œìœ ê¶Œì„ ì´ë™í•˜ì—¬ ë³µì‚¬ ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
const buffer = new ArrayBuffer(1024 * 1024);
worker.postMessage(buffer, [buffer]); // ì†Œìœ ê¶Œ ì´ë™
```

**ì£¼ì˜ì‚¬í•­:**

- ì „ì†¡ í›„ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œëŠ” bufferë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- ì¬ì‚¬ìš©í•´ì•¼ í•˜ë©´ ë³µì‚¬ë³¸ì„ ìœ ì§€

---

## 6. ì ìš© íŒ¨í„´

- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì •ë ¬/í•„í„°/ì§‘ê³„
- ì´ë¯¸ì§€ ì²˜ë¦¬/ì••ì¶•
- JSON íŒŒì‹±/ì§ë ¬í™”
- ì•”í˜¸í™”/í•´ì‹œ ê³„ì‚°

---

## 7. ì£¼ì˜ì‚¬í•­

- ì›Œì»¤ëŠ” DOM ì ‘ê·¼ ë¶ˆê°€ (UI ì¡°ì‘ ë¶ˆê°€)
- ë©”ì‹œì§€ ì „ë‹¬ ë¹„ìš©ì´ í° ë°ì´í„°ì—ì„œëŠ” ì˜¤íˆë ¤ ëŠë¦´ ìˆ˜ ìˆìŒ
- ì›Œì»¤ ìƒì„±/ì¢…ë£Œ ë¹„ìš©ì´ ìˆìœ¼ë¯€ë¡œ ì¬ì‚¬ìš© ê³ ë ¤
- ì—ëŸ¬ ì²˜ë¦¬ëŠ” `worker.onerror`ë¡œ ë³„ë„ ì²˜ë¦¬

---

## 8. ì‹¤ì „ ì ìš© ì²´í¬ë¦¬ìŠ¤íŠ¸

- ë©”ì¸ ìŠ¤ë ˆë“œê°€ ìì£¼ ë§‰íˆëŠ”ê°€? â†’ ì›Œì»¤ ê³ ë ¤
- ì‘ì—…ì´ ìˆœìˆ˜ ê³„ì‚°ì¸ê°€? â†’ ì›Œì»¤ ì í•©
- ëŒ€ìš©ëŸ‰ ë°ì´í„° ì „ì†¡ì´ í•„ìš”í•œê°€? â†’ Transferable ì‚¬ìš©
- ì§„í–‰ ìƒíƒœ í‘œì‹œê°€ í•„ìš”í•œê°€? â†’ PROGRESS ë©”ì‹œì§€ ì„¤ê³„
- ì›Œì»¤ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•œê°€? â†’ í’€ë§ ê³ ë ¤

---

## ì‹¤í–‰ ë°©ë²•

í˜„ì¬ ì˜ˆì œ ì½”ë“œëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì½”ë“œê°€ ì¶”ê°€ë˜ë©´ ì‹¤í–‰ ë°©ë²•ì„ ì—…ë°ì´íŠ¸í•˜ê² ìŠµë‹ˆë‹¤.

---

## ì¸¡ì • ë°©ë²•

### 1. Performance íŒ¨ë„

- Chrome DevTools > Performance > Record
- ë©”ì¸ ìŠ¤ë ˆë“œ ì ìœ  ì‹œê°„ê³¼ long task í™•ì¸

### 2. ì‚¬ìš©ì ì²´ê°

- ì‘ì—… ì¤‘ ì…ë ¥/ìŠ¤í¬ë¡¤ ë°˜ì‘ì„± ë¹„êµ
- ì§„í–‰ ìƒíƒœ í‘œì‹œ ìœ ë¬´ì— ë”°ë¥¸ ì²´ê° ì°¨ì´ í™•ì¸

---

## í•µì‹¬ ìš”ì•½

- Web WorkerëŠ” **ë©”ì¸ ìŠ¤ë ˆë“œ ë¶€í•˜ë¥¼ ë¶„ë¦¬**í•´ UI ë°˜ì‘ì„±ì„ ê°œì„ 
- ë©”ì‹œì§€ ì „ë‹¬ ë¹„ìš©ì„ ê³ ë ¤í•´ **Transferable** í™œìš©
- ì§„í–‰ ìƒíƒœë¥¼ ì „ë‹¬í•´ UX ì•ˆì •ì„± í–¥ìƒ
- ì›Œì»¤ ìƒì„± ë¹„ìš©ê³¼ ì¬ì‚¬ìš© ì „ëµì„ í•¨ê»˜ ê³ ë ¤

---

## ğŸ“š ì°¸ê³  ìë£Œ (References)

**Web Workers**

- [MDN: Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API)
- [MDN: Worker.postMessage](https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage)
- [MDN: Transferable objects](https://developer.mozilla.org/en-US/docs/Web/API/Transferable)

**ì„±ëŠ¥ ìµœì í™”**

- [Web.dev: Optimize Long Tasks](https://web.dev/optimize-long-tasks/)
